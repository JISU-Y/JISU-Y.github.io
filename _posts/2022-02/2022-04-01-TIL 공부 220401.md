---
layout: single
title: "[TIL] rollup í•™ìŠµ 1"
categories: TIL
tag: [TIL, rollup]
toc: true
author_profile: true
sidebar:
  nav: "docs"
---

# TIL

**ì…ì‚¬ ì „ ì¶”ê°€ ê³µë¶€**

## ë²ˆë“¤ëŸ¬

### Rollup

#### Rollupì´ë€?

> ë¹Œë“œíˆ´ / ë²ˆë“¤ëŸ¬ì´ë‹¤.  
> ìˆ˜ ë§ì€ js ì½”ë“œ ì¡°ê°ì„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ ì‘ìš© í”„ë¡œê·¸ë¨ìœ¼ë¡œ ë” í¬ê³  ë³µì¡í•œ ê²°ê³¼ë¡œ ì»´íŒŒì¼í•´ì£¼ëŠ” Javascriptìš© ëª¨ë“ˆ ë²ˆë“¤ëŸ¬ì´ë‹¤.

ì¥ì ì€ ë‚˜ë¬´ í”ë“¤ê¸° ê¸°ë²• (Tree shaking)ì„ í™œìš©í•˜ì—¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ í•„ìš”í•œ ë¶€ë¶„ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.  
ê·¸ëŸ¬ë‹ˆ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì½”ë“œëŠ” ë¹Œë“œ ë‹¨ì—ì„œ ì œê±°í•˜ì—¬ ë¹Œë“œ í¬ê¸°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œì‘ ìš©ë„ì— íŠ¹í™”ë˜ì–´ ìˆë‹¤.

[ì¶œì²˜] <https://wormwlrm.github.io/2021/11/07/Rollup-React-TypeScript.html>

#### êµ¬í˜„

**ì½”ë“œ ì¡°ê° 1**

ì—°ì‚° í•¨ìˆ˜ë¥¼ ëª¨ì•„ë‘” íŒŒì¼.

```jsx
// src/math.js
export const add = (a, b) => a + b;
export const substract = (a, b) => a - b;
```

**ì½”ë“œ ì¡°ê° 2**

ì—°ì‚° í•¨ìˆ˜ë¥¼ import í•˜ì—¬ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” íŒŒì¼.

```jsx
// src/index.js
import { add, substract } from "./math";

const sum = add(3, 4);

export { sum }; // ì´ ëª¨ë“ˆì„ ì‚¬ìš©í•  ë•Œ ì™¸ë¶€ì—ì„œëŠ” ì´ sum ê°’ì„ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.
```

**moduleí™”í•˜ì—¬ ë‚´ë³´ë‚´ê¸°**

```
./node_modules/.bin/rollup src/index.js -d lib
```

ìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ lib í´ë”ì— ë²ˆë“¤ ê²°ê³¼ë¬¼ index.js ìƒì„±í–ˆë‹¤.

```jsx
// lib/index.js
const add = (a, b) => a + b;

const sum = add(3, 4);

export { sum };
```

src index.jsì—ì„œ substractë¥¼ import í–ˆì§€ë§Œ ëª¨ë“ˆì—ì„œëŠ” ë‚˜ì˜¤ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

export ê°’ì— ì‚¬ìš©ì´ ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤.

```jsx
const a = 4;
```

src index.jsì— ëœ¬ê¸ˆì—†ì´ ì´ ì½”ë“œë¥¼ ì¶”ê°€í•´ë„ ë²ˆë“¤ ì´í›„ ë‚˜ì˜¤ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ì´ë¥¼ **ë‚˜ë¬´í”ë“¤ê¸°(tree shaking)**ë¼ê³  í•œë‹¤.

#### rollup config

rollup ë²ˆë“¤ëŸ¬ ì„¤ì •.

ë³´í†µ json ë§ê³  jsë¡œ ì‚¬ìš©í•œë‹¤.

```jsx
const config = {
  input: "src/index.js",
  output: {
    file: "lib/index.js",
    format: "iife", // iife // immedietly invokable function expression // ì¦‰ì‹œ í˜¸ì¶œ ê°€ëŠ¥í•œ í•¨ìˆ˜ í‘œí˜„
    name: "RollupTest", // ì™¸ë¶€ì—ì„œ ì°¸ì¡°í•  ì´ë¦„ í•„ìš”
  },
};

export default config;
```

ì´ë ‡ê²Œ ì„¤ì •í•˜ê³  config ì„¤ì •ìœ¼ë¡œ ë²ˆë“¤ë§ í•˜ë¼ëŠ” ëª…ë ¹ì–´

```
./node_modules/.bin/rollup -c
```

ë¥¼ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë²ˆë“¤ë§ì´ ëœë‹¤.

```jsx
var RollupTest = (function (exports) {
  "use strict";

  const add = (a, b) => a + b;

  const sum = add(3, 4);

  exports.sum = sum;

  Object.defineProperty(exports, "__esModule", { value: true });

  return exports;
})({});
```

ì´ëŸ° ì‹ìœ¼ë¡œ RollupTestë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì¦‰ì‹œ í•¨ìˆ˜ í‘œí˜„ì´ ë§Œë“¤ì–´ì§€ê³ ,  
ì™¸ë¶€ì—ì„œëŠ” RollupTestë¼ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë²ˆë“¤ë§ëœë‹¤.

esmìœ¼ë¡œ ë²ˆë“¤ë§í•˜ë©´

```jsx
const config = {
  input: "src/index.js",
  output: {
    file: "lib/index.js",
    format: "esm",
    name: "RollupTest",
  },
};

export default config;
```

ë‹¤ìŒê³¼ ê°™ì´ ë²ˆë“¤ë§ì´ ëœë‹¤.

```jsx
const add = (a, b) => a + b;

const sum = add(3, 4);

export { sum };
```

#### babel transpiling

ì‘ì„±í•œ ì½”ë“œë¥¼ ì†ŒìŠ¤ ê·¸ëŒ€ë¡œ ë²ˆë“¤ë§í•˜ëŠ” ê²ƒ ë³´ë‹¤ëŠ”  
ë³´í†µ ë°”ë²¨ì„ ì´ìš©í•˜ì—¬ íŠ¸ëœìŠ¤íŒŒì¼ë§í•˜ê³  ê·¸ íŠ¸ëœìŠ¤íŒŒì¼ëœ ì½”ë“œë¥¼ ë²ˆë“¤ë§í•˜ê²Œ ëœë‹¤.

**ë°”ë²¨ ì„¤ì¹˜**

```
yarn add -D @babel/core @babel/cli @babel/preset-env @babel/preset-react
```

**ë°”ë²¨ ì„¤ì •**

ë°”ë²¨ ì„¤ì •ì€ ë‹¤ìŒê³¼ ê°™ì´ package.jsonì—ì„œ ê°„ë‹¨í•˜ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. (babelrc íŒŒì¼ êµ³ì´ ë”°ë¡œ ì•ˆë§Œë“¤ì–´ë„ ë¨)

```json
{
  "name": "rollup-test",
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT",
  "devDependencies": {
    "@babel/cli": "^7.17.6",
    "@babel/core": "^7.17.8",
    "@babel/preset-env": "^7.16.11",
    "@babel/preset-react": "^7.16.7",
    "rollup": "^2.70.1"
  },
  "babel": {
    "presets": ["@babel/preset-env", "@babel/preset-react"]
  }
}
```

**ë°”ë²¨ íŠ¸ëœìŠ¤íŒŒì¼ë§**

ì‘ì„±í•œ ì½”ë“œë¥¼ íŠ¸ëœìŠ¤íŒŒì¼ë§í•˜ì—¬ dist íŒŒì¼ì•ˆì— ë„£ìŒ

```
$ babel src -d dist
bash: babel: command not found
```

ê¹¨ì•Œë¡œ babelì´ cliê°€ ë¨¹íˆì§€ ì•Šì•˜ë‹¤.

ê²€ìƒ‰ ê²°ê³¼ babel ëª…ë ¹ì–´ëŠ” ë‹¤ìŒì˜ ì¤„ì„ì–´ì˜€ë‹¤.

```
$ ./node_modules/.bin/babel src -d dist
```

ìœ„ì™€ ê°™ì´ ì‘ì„±í•˜ë‹ˆ íŠ¸ëœìŠ¤íŒŒì¼ë§ì´ ì„±ê³µì ìœ¼ë¡œ ë˜ì—ˆë‹¤. (src í´ë”ì˜ ëª¨ë“  js íŒŒì¼ì´ íŠ¸ëœìŠ¤íŒŒì¼ë§ë˜ì–´ dist í´ë” ì•ˆì— ì €ì¥)

```jsx
// dist/index.js
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true,
});
exports.sum = void 0;

var _math = require("./math");

var sum = (0, _math.add)(3, 4);

exports.sum = sum;
```

#### rollup plugin

í•˜ì§€ë§Œ, ì´ë ‡ê²Œ ë°”ë²¨ íŠ¸ëœìŠ¤íŒŒì¼ë§ í•˜ê³  ë˜ ë¡¤ì—… ë²ˆë“¤ë§í•˜ë©´ ê·€ì°®ë‹¤.

ë”°ë¼ì„œ rollupì—ì„œ pluginì„ ì œê³µí•œë‹¤.

```
yarn add -D @rollup/plugin-babel
```

ë°”ë²¨ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•œ í›„ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì •í•´ì¤€ë‹¤.

ì´ì œ ì´ ë¡¤ì—…ì€ ì‹¤ì œ ì‘ì„±í•œ ì½”ë“œ src/indexì˜ íŒŒì¼ì„ ë²ˆë“¤ë§í•  ë•Œ ë°”ë²¨ íŠ¸ëœìŠ¤íŒŒì¼ë§ì„ ê±°ì³ì„œ libì— index.jsë¡œ ë²ˆë“¤ë§í•˜ì—¬ ë‚˜íƒ€ë‚´ì¤„ ê²ƒì´ë‹¤.

```jsx
import babel from "@rollup/plugin-babel";

const config = {
  input: "src/index.js",
  output: {
    file: "lib/index.js",
    format: "esm",
  },
  plugins: [babel()],
};

export default config;
```

ë²ˆë“¤ë§ í›„

```jsx
var add = function add(a, b) {
  return a + b;
};

var sum = add(3, 4);
// ì´ ëª¨ë“ˆì„ ì‚¬ìš©í•  ë•Œ ì™¸ë¶€ì—ì„œëŠ” ì´ sum ê°’ì„ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

export { sum };
```

[ì¶œì²˜] <https://www.youtube.com/watch?v=6cG4GDi4Ee4&list=LL&index=2&t=291s>

## íšŒê³  (TIL)

**2022.04.01 Daily íšŒê³ **

âœì˜¤ëŠ˜ í•œ ì¼

- ì…ì‚¬ ì „ ì¶”ê°€ ê³µë¶€
  - rollup

â‰ëŠë‚€ ì 

ì…ì‚¬í•˜ê²Œ ë  íšŒì‚¬ì—ì„œ ê³µí†µ ëª¨ë“ˆë¡œ rollupì„ ì‚¬ìš©í•œë‹¤ê³  í–ˆê¸° ë•Œë¬¸ì— rollupì— ëŒ€í•´ì„œ ì¢€ ë” ê³µë¶€í•´ë³´ì•˜ë‹¤.

ëŠë‚Œì ì¸ ëŠë‚Œìœ¼ë¡œ webpackë³´ë‹¤ ê°„ë‹¨í•œ? ëŠë‚Œì´ ë“ ë‹¤..

ì•„ì§ ì™œ ì‚¬ìš©í•˜ëŠ” ì§€ì— ëŒ€í•œ ê°œë…ì´ ì—†ë‹¤ë³´ë‹ˆ ëˆˆì— ì•ˆë“¤ì–´ì˜¤ëŠ” ê²ƒ ê°™ë‹¤.

ì‹¤ì œ ì‚¬ìš©í•˜ê³  ìˆëŠ” ëª¨ë“ˆì„ í•œë²ˆ ë´ì•¼ê² ë‹¤.

ğŸƒí˜„ì¬ ë‚˜ì˜ ìƒíƒœ

í”¼ê³¤ì“°..

<hr>
